"use strict";const supportedLocales=["de","es","fr","hu","it","ja","ko","pr-br","ru","tr","zh-cn","zh-tw"];let editor,theme;function init(){postMessageToPortal("init")}function getUserLocale(){const e=window.navigator.language.toLowerCase(),t=e.substr(0,e.indexOf("-"));return supportedLocales.indexOf(t)>=0?t:supportedLocales.indexOf(e)>=0?e:null}function prepareAndLaunchEditor(e){const t=getLanguageForFilename(e.payload.filename);launchEditor(e.payload.code,t,theme)}function getLanguageForFilename(e){for(const t of monaco.languages.getLanguages())for(const n of t.extensions)if(e.endsWith(n))return t.id;return null}function errorHandler(e){console.error(e)}function launchEditor(e,t,n){editor=monaco.editor.create(document.getElementById("container"),{value:e,scrollBeyondLastLine:!1,language:t,cursorBlinking:"smooth",dragAndDrop:!0,mouseWheelZoom:!0,theme:n}),addMenuItems(),monaco.languages.typescript.javascriptDefaults.setCompilerOptions({allowNonTsExtensions:!0});fetch("../lib/portal-unleashed/dist/unleash.d.ts").then(e=>e.text()).then(e=>{monaco.languages.typescript.typescriptDefaults.addExtraLib(e,"")}).catch(errorHandler),window.addEventListener("resize",function(){editor.layout()}),editor._actions={}}function addMenuItems(){editor.addAction({id:"export",label:"Export content",contextMenuGroupId:"portal_0",contextMenuOrder:1,run:function(){const e=editor.getValue(),t=`data:text/javascript;charset=utf-8,${encodeURIComponent(e)}`,n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","script.js"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}),editor.addAction({id:"modeFullscreen",label:"Fullscreen",contextMenuGroupId:"portal_1",contextMenuOrder:1,run:function(){updateMode("fullscreen")}}),editor.addAction({id:"modeSplitScreenLeft",label:"Splitscreen (Left)",contextMenuGroupId:"portal_1",contextMenuOrder:2,run:function(){updateMode("splitscreen-left")}}),editor.addAction({id:"modeSplitScreenRight",label:"Splitscreen (Right)",contextMenuGroupId:"portal_1",contextMenuOrder:3,run:function(){updateMode("splitscreen-right")}}),editor.addAction({id:"modeDisable",label:"Disable",contextMenuGroupId:"portal_1",contextMenuOrder:4,run:function(){updateMode("disable")}}),editor.addAction({id:"themeLight",label:"Light Theme",contextMenuGroupId:"portal_2",contextMenuOrder:1,run:function(){updateTheme("vs")}}),editor.addAction({id:"themeDark",label:"Dark Theme",contextMenuGroupId:"portal_2",contextMenuOrder:2,run:function(){updateTheme("vs-dark")}}),editor.addAction({id:"themeHighContrast",label:"High Contrast Theme",contextMenuGroupId:"portal_2",contextMenuOrder:3,run:function(){updateTheme("hc-black")}})}function updateMode(e){postMessageToPortal("update-mode",e)}function updateTheme(e){monaco.editor.setTheme(e),postMessageToPortal("update-theme",e)}function postMessageToPortal(e,t){window.parent.postMessage({plugin:"portal-unleashed",type:e,payload:t},"*")}document.onkeydown=function(e){if((e.metaKey||e.ctrlKey)&&"s"==e.key){e.preventDefault(),postMessageToPortal("execute",editor.getValue())}},window.addEventListener("message",function(e){const t=e.data;if(t&&"init"===t.type){t.payload.theme&&(theme=t.payload.theme),require.config({paths:{vs:"../lib/monaco-editor/min/vs"}});const e=getUserLocale();null!==e&&require.config({"vs/nls":{availableLanguages:{"*":e}}}),require(["vs/editor/editor.main"],function(){prepareAndLaunchEditor(t),require(["vs/platform/actions/common/actions"],function(e){let t=[...e.MenuRegistry._menuItems].find(e=>e[1].find(e=>"navigation"==e.group))[1],n=["editor.action.clipboardCopyAction","editor.action.clipboardCutAction"];for(let e=0;e<t.length;){const o=t[e];o.command&&-1!==n.indexOf(o.command.id)?t.splice(e,1):e++}})})}}),init();